# 登录流程
## 口令登录

## ukey 登录

### 总体登录流程

ukey 登录流程

**client:**  
1. 服务端->随机数，服务端公钥->client
2. 获取client信息
3. hash client信息 clientInfoHash
4.  获取client签名证书
5. 获取client签名证书sn
7. 对 clientInfoHash 签名 clientInfoHashSign
8. 生成对称随机密码
9. 服务端公钥加密对称随机密码
10. 采用随机对称密码 加密clientInfo 和clientInfoHashSign值 
11. 填充登录表单 执行登录流程

**server:**
1. server端收到请求 校验随机数是否匹配
2. 服务端私钥解密随机对称密码
3. 用对称密码，解密 clientInfoHash 和 clientInfo
4. 服务端jni hash clientInfo 得到 clientInfoHash
5. 验证 clientInfoHash clientInfoHashSign 
6. 解析client 签名证书  验证是否为根证书颁发
7. 验证sn是否存在，sn是否绑定
8. 登录通过 颁发票据，全局sessionId

### ukey 表单设计
参见：com.ncs.sso.server.vo.UKeyLoginForm

clientSignCertSN 证书号，必须有  
clientSignCert 没必要传，查库或查ldap  
encodePassword 对称加密密码（服务端公钥加密）  
encodeData  加密数据（clientInfo +clientInfo hash的签名值）  
encodeType 加密类型（软硬，硬加密无法用，软加密：jni windows无法跑）  
hashType  clientInfo hash类型  
random 服务端随机数  


  
### ie低版本 ukey控件实现
参见 ukey.js

### 其他浏览器 websocket
参见 ukey-websocket.js
